{% extends 'base1.html.twig' %}

{% block title %}Hello ClientController!
{% endblock %}

{% block body %}


<div class="example-wrapper">
    <table class="table position-relative">
        <div class=" d-flex justify-content-between">
            <a href="javascript:afficher()" class="btn btn-primary btn-sm">Show</a>
            <a href="javascript:modify()" class="btn btn-success btn-sm">Modify</a>
            <a href="javascript:supprimer()" class="btn btn-danger btn-sm">Delete</a>
        </div>
        <thead>
            <tr class=" position-sticky">
                <th></th>
                <th>CODE</th>
                <th>Client NÂ°</th>
                <th>Name</th>
                <th>Adresse</th>
            </tr>
        </thead>
        <tbody id="tbody_client">
            {% for client in clients %}
            <tr>
                <td><input type="checkbox" class="form-check-input" value="{{client.id}}" id="{{client.id}}"
                        name="check" onclick="onlyOne(this)"></td>
                <td>{{client.id}}</td>
                <td>{{client.numClient}}</td>
                <td>{{client.nameClient}}</td>
                <td>{{client.adresseClient}}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <th colspan="5" class="text-center" id="count">Total: {{total}}</th>
            </tr>
        </tfoot>
    </table>
</div>
{% block script %}
<script>
    const ajouter = () => {
        document.location.href = "{{path('app_client_add')}}";
    }

    const supprimer = () => {
        let response = confirm('Do you really want to delete this client?');
        if (response) {
            let id = getIdChecked('check');
            if (id == 0) {
                alert('Please select client you want to delete');
            } else {
                document.location.href = `/client/delete/${id}`;
            }
        }
    }

    const modify = () => {
        let id = getIdChecked('check');
        if (id == 0) {
            alert('Please select the client to modify');
        } else {
            document.location.url = `/client/modify/${id}`;
        }
    }

    const afficher = () => {
        const id = getIdChecked('check');
        if (id == 0) {
            alert('Please select client to get the detail');
        } else {
            document.location.href = `/client/show/${id}`;
        }
    }

    const url = "{{path('app_client_search')}}";
    const search = () => {
        let mot = document.getElementById('mot');
        let xhr = new XMLHttpRequest();
        xhr.open('POST', url);
        let data = new FormData();
        data.append('mot', mot.value)
        xhr.onload = () => {
            let response = xhr.responseText;
            response = JSON.parse(response);
            const clients = response['rows'];
            const count = response['total'];
            const html = clients.map((client) => {
                return `
                <tr>
                <td><input type="checkbox" class="form-check-input" value="${client.id}" id="${client.id}"
                        name="check" onclick="onlyOne(this)"></td>
                <td>${client.id}</td>
                <td>${client.numClient}</td>
                <td>${client.nameClient}</td>
                <td>${client.adresseClient}</td>
            </tr>
                `;
            }).join('');
            document.getElementById('tbody_client').innerHTML = html;
            document.getElementById('count').innerHTML = `Total Clients : ${count}`;
            mot.value = '';

        }
        xhr.send(data);
    }

</script>
{% endblock %}
{% endblock %}